<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DexScreener API 调试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .success { border-color: #4CAF50; background: #f8fff8; }
        .error { border-color: #f44336; background: #fff8f8; }
        .loading { border-color: #2196F3; background: #f8f9ff; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .icon-test {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .icon-test img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid #ddd;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <h1>🔍 DexScreener API 调试工具</h1>
    
    <div class="container">
        <h2>测试代币地址</h2>
        <button onclick="testToken('0x000ae314e2a2172a039b26378814c252734f556a', 'ASTER')">测试 ASTER</button>
        <button onclick="testToken('0x932fb7f52adbc34ff81b4342b8c036b7b8ac4444', 'DUST')">测试 DUST</button>
        <button onclick="testCustomToken()">测试自定义地址</button>
        <input type="text" id="customAddress" placeholder="输入代币地址" style="margin-left: 10px; padding: 8px;">
    </div>

    <div id="results"></div>

    <script>
        async function testToken(address, name) {
            const resultsDiv = document.getElementById('results');
            const testDiv = document.createElement('div');
            testDiv.className = 'test-item loading';
            testDiv.innerHTML = `
                <h3>🔄 测试 ${name} (${address})</h3>
                <p>正在获取数据...</p>
            `;
            resultsDiv.appendChild(testDiv);

            try {
                console.log(`🔍 测试代币: ${name} (${address})`);
                
                // 调用 DexScreener API
                const response = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${address}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log(`✅ API 响应:`, data);

                if (!data.pairs || data.pairs.length === 0) {
                    throw new Error('没有找到交易对数据');
                }

                // 找到最佳交易对
                const bestPair = data.pairs.reduce((best, current) => {
                    const bestLiquidity = parseFloat(best.liquidity?.usd || '0');
                    const currentLiquidity = parseFloat(current.liquidity?.usd || '0');
                    return currentLiquidity > bestLiquidity ? current : best;
                });

                console.log(`🎯 最佳交易对:`, bestPair);

                // 提取代币信息
                const tokenInfo = bestPair.baseToken;
                const imageUrl = bestPair.info?.imageUrl;

                testDiv.className = 'test-item success';
                testDiv.innerHTML = `
                    <h3>✅ ${name} 测试成功</h3>
                    <div class="icon-test">
                        <img src="${imageUrl || 'https://via.placeholder.com/40x40/6366f1/ffffff?text=' + (tokenInfo.symbol?.charAt(0) || '?')}" 
                             alt="${tokenInfo.name}" 
                             onload="console.log('✅ 图标加载成功:', this.src)"
                             onerror="console.log('❌ 图标加载失败:', this.src); this.src='https://via.placeholder.com/40x40/ff6b6b/ffffff?text=X'">
                        <div>
                            <div><strong>名称:</strong> ${tokenInfo.name || 'N/A'}</div>
                            <div><strong>符号:</strong> ${tokenInfo.symbol || 'N/A'}</div>
                            <div><strong>地址:</strong> ${tokenInfo.address || 'N/A'}</div>
                            <div><strong>图标URL:</strong> ${imageUrl || '无'}</div>
                        </div>
                    </div>
                    <details>
                        <summary>查看完整响应</summary>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </details>
                `;

            } catch (error) {
                console.error(`❌ 测试失败:`, error);
                testDiv.className = 'test-item error';
                testDiv.innerHTML = `
                    <h3>❌ ${name} 测试失败</h3>
                    <p><strong>错误:</strong> ${error.message}</p>
                    <p><strong>地址:</strong> ${address}</p>
                `;
            }
        }

        function testCustomToken() {
            const address = document.getElementById('customAddress').value.trim();
            if (!address) {
                alert('请输入代币地址');
                return;
            }
            testToken(address, '自定义代币');
        }

        // 页面加载时自动测试
        window.onload = function() {
            console.log('🚀 DexScreener API 调试工具已加载');
        };
    </script>
</body>
</html>
